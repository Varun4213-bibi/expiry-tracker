{% extends 'base.html' %}
{% load static %}

{% block title %}Your Inventory - Expiry Tracker{% endblock %}

{% block extra_head %}
<style>
  .inventory-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 0 0 20px 20px;
  }

  .stats-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
  }

  .stats-number {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }

  .item-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.08);
    margin-bottom: 1rem;
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
  }

  .item-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
  }

  .item-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 1rem 1.5rem;
    border-radius: 15px 15px 0 0;
    border-bottom: 1px solid #dee2e6;
  }

  .item-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: #f6f8f9;
    margin-bottom: 0.25rem;
  }

  .item-category {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .item-body {
    padding: 1.5rem;
  }

  .expiry-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .expiry-date {
    font-weight: 500;
    color: #495057;
  }

  .days-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .expired-badge {
    background: linear-gradient(135deg, #e95665 0%, #ed0a21 100%);
    color: white;
  }

  .expiring-soon-badge {
    background: linear-gradient(135deg, #fd7e14 0%, #e8680d 100%);
    color: white;
  }

  .expiring-30-badge {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: #212529;
  }

  .safe-badge {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    color: white;
  }

  .today-badge {
    background: linear-gradient(135deg, #6f42c1 0%, #5a359a 100%);
    color: white;
  }

  .item-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .detail-item {
    display: flex;
    flex-direction: column;
  }

  .detail-label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
    margin-bottom: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .detail-value {
    font-weight: 600;
    color: #495057;
  }

  .item-details-compact {
    text-align: center;
    margin-bottom: 1rem;
  }

  .days-left-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }

  .days-number {
    font-size: 2.5rem;
    font-weight: bold;
    line-height: 1;
  }

  .days-label {
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .action-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .btn-custom {
    border-radius: 25px;
    padding: 0.5rem 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    border: none;
  }

  .btn-edit {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: white;
  }

  .btn-edit:hover {
    background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
    transform: translateY(-1px);
  }

  .btn-donate {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    color: white;
  }

  .btn-donate:hover {
    background: linear-gradient(135deg, #1e7e34 0%, #155724 100%);
    transform: translateY(-1px);
  }

  .btn-delete {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
  }

  .btn-delete:hover {
    background: linear-gradient(135deg, #c82333 0%, #a02622 100%);
    transform: translateY(-1px);
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }

  .empty-state-icon {
    font-size: 4rem;
    color: #dee2e6;
    margin-bottom: 1.5rem;
  }

  .empty-state-title {
    font-size: 1.5rem;
    color: #6c757d;
    margin-bottom: 1rem;
  }

  .empty-state-text {
    color: #adb5bd;
    margin-bottom: 2rem;
  }

  .btn-add-first {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: white;
    border: none;
    border-radius: 25px;
    padding: 0.75rem 2rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
  }

  .btn-add-first:hover {
    background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,123,255,0.3);
  }
  .item-card.expired {
    background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
  }

  .item-card.expiring-soon {
    background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);
  }

  .item-card.safe {
    background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
  }


  @media (max-width: 768px) {
    .inventory-header {
      padding: 1.5rem 1rem;
      text-align: center;
    }

    .stats-card {
      margin-bottom: 1rem;
    }

    .item-details {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .action-buttons {
      justify-content: center;
    }

    .btn-custom {
      flex: 1;
      min-width: 120px;
    }
  }

  @media (max-width: 576px) {
    .inventory-header h1 {
      font-size: 1.75rem;
    }

    .stats-number {
      font-size: 2rem;
    }

    .item-card {
      margin-bottom: 0.75rem;
    }

    .item-body {
      padding: 1rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="inventory-header">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h1 class="mb-0"><i class="bi bi-box-seam me-3"></i>Your Inventory</h1>
        <p class="mb-0 mt-2 opacity-75">Track and manage your expiring items</p>
      </div>
    </div>
  </div>
</div>

<div class="container">
  {% if items %}
    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-lg-3 col-md-6">
        <div class="stats-card">
          <div class="stats-number text-primary">{{ items|length }}</div>
          <div class="text-muted">Total Items</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="stats-card">
          <div class="stats-number text-danger">{{ expired_count }}</div>
          <div class="text-muted">Expired</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="stats-card">
          <div class="stats-number text-warning">{{ expiring_soon_count }}</div>
          <div class="text-muted">Expiring Soon</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="stats-card">
          <div class="stats-number text-success">{{ safe_count }}</div>
          <div class="text-muted">Safe</div>
        </div>
      </div>
    </div>

    <!-- Items Grid -->
    <div class="row">
      {% for item in items %}
      <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 mb-3">
        <div class="item-card {% if item.expiry_status == 'Expired' %}expired{% elif item.expiry_status == 'Expiring Soon' %}expiring-soon{% else %}safe{% endif %}">

          <div class="item-header">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="item-name">{{ item.name }}</h6>
                <span class="item-category">{{ item.category }}</span>
              </div>
              <div class="text-end">
                {% if item.expiry_status == 'Expired' %}
                  <span class="days-badge expired-badge">Expired</span>
                {% elif item.expiry_status == 'Expiring Soon' %}
                  <span class="days-badge expiring-soon-badge">Expiring Soon</span>
                {% elif item.expiry_status == 'Expiring in 30 Days' %}
                  <span class="days-badge expiring-30-badge">Expiring in 30 Days</span>
                {% elif item.expiry_status == 'Expires Today' %}
                  <span class="days-badge today-badge">Today</span>
                {% else %}
                  <span class="days-badge safe-badge">Safe</span>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="item-body">
            <div class="expiry-info">
              <i class="bi bi-calendar-event text-muted"></i>
              <span class="expiry-date">Expires: {{ item.expiry_date|date:"M j, Y" }}</span>
            </div>

            <div class="item-details-compact">
              <div class="days-left-display">
                {% if item.days_left is not None %}
                  {% if item.days_left < 0 %}
                    <div class="days-number text-danger">{{ item.abs_days_left }}</div>
                    <div class="days-label text-danger">days ago</div>
                  {% elif item.days_left == 0 %}
                    <div class="days-number text-warning">0</div>
                    <div class="days-label text-warning">today</div>
                  {% elif item.days_left <= 7 %}
                    <div class="days-number text-warning">{{ item.days_left }}</div>
                    <div class="days-label text-warning">days left</div>
                  {% else %}
                    <div class="days-number text-success">{{ item.days_left }}</div>
                    <div class="days-label text-success">days left</div>
                  {% endif %}
                {% else %}
                  <div class="days-number text-muted">â€”</div>
                  <div class="days-label text-muted">unknown</div>
                {% endif %}
              </div>
            </div>

            <div class="action-buttons">
              <a href="{% url 'add_item' %}?barcode={{ item.barcode }}" class="btn btn-custom btn-edit">
                <i class="bi bi-pencil-square me-1"></i>Edit
              </a>
              {% if item.category == 'Medicine' and item.expiry_status != 'Expired' %}
              <form method="post" action="{% url 'donate_item' item.id %}" style="display:inline;" onsubmit="return confirm('Mark this medicine as donated?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-custom btn-donate">
                  <i class="bi bi-hand-heart-fill me-1"></i>Donate
                </button>
              </form>
              {% endif %}
              <form method="post" action="{% url 'delete_item' item.id %}" style="display:inline;" onsubmit="return confirm('Delete this item?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-custom btn-delete">
                  <i class="bi bi-trash me-1"></i>Delete
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">
        <i class="bi bi-box-seam"></i>
      </div>
      <h3 class="empty-state-title">No items in your inventory</h3>
      <p class="empty-state-text">Start tracking your expiring items by adding your first item.</p>
      <a href="{% url 'add_item' %}" class="btn-add-first">
        <i class="bi bi-plus-lg me-2"></i>Add Your First Item
      </a>
    </div>
  {% endif %}
</div>

<!-- Offline Items Section (if needed) -->
<div id="offline-items" class="mt-4" style="display: none;"></div>
{% endblock %}

{% block extra_js %}
<script>
  // Add any interactive functionality here
  document.addEventListener('DOMContentLoaded', function() {
    // Smooth scroll for anchor links if needed
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    anchorLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  });
</script>
{% endblock %}
